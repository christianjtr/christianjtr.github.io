---
import { getCollection } from 'astro:content';
import { BadgeList, Section, HorizontalSpacer } from "../";
import Logo from '@assets/svg/background.svg';
import Pin from '@assets/svg/pin.svg';
import Monitor from '@assets/svg/monitor.svg';
import Building from '@assets/svg/building.svg';

const experiences = await getCollection('experiences');
const countryCounts = Object.entries(experiences.reduce((acc: Record<string, number>, item) => {
  const country = item.data.country;
  acc[country] = (acc[country] || 0) + 1;
  return acc;
}, {}));

const additionalCountries = [
    "USA",
    "UK",
    "France"
];

---

<div class="bg-primary/5 py-10">
    <Section headingTitle="Professional Experiences" subtitle="A comprehensive look at my professional growth and key accomplishments across different countries" class="space-y-5 container mx-auto">
        <Logo slot="beforeHeading" width={96} height={96} />
        <HorizontalSpacer />
        <div class="flex md:flex-row flex-col px-5 md:px-10">
            <div class="stats lg:stats-horizontal stats-vertical bg-base-100 w-full shadow-lg shadow-indigo-100">
                <div class="stat">
                    <div class="stat-figure">
                        <Pin width={40} height={40} />
                    </div>
                    <span class="stat-title uppercase">Countries Worked In</span>
                    <span class="stat-value text-primary text-5xl text-thin">0{countryCounts.length}</span>
                    <p class="stat-desc mt-3">Collaborated with peers from</p>
                    <div class="stat-actions">
                        {additionalCountries.map((country) => (
                            <span class="badge badge-sm mr-1.5 badge-soft text-white">{country}</span>
                        ))}
                    </div>
                </div>
                <div class="stat">
                    <span class="stat-title uppercase">Experience by country</span>
                    <div class="mt-5 space-y-2">
                        {countryCounts.map(([country, count]) => (
                            <p class="mr-1.5 flex justify-between">
                                <span>{country}</span>
                                <span class="w-5 badge border-0 rounded-full px-4 bg-pink-500 text-white">{count}</span>
                            </p>
                        ))}
                    </div>
                </div>
                <div class="stat">
                    <div class="stat-figure">
                        <Building width={40} height={40} />
                    </div>
                    <span class="stat-title uppercase">Companies Worked For</span>
                    <span class="stat-value text-primary text-5xl">0{experiences.length}</span>
                    <p class="stat-desc w-32 flex flex-wrap">Mostly B2B product companies</p>
                </div>
                <div class="stat">
                    <div class="stat-figure">
                        <Monitor width={40} height={40} />
                    </div>
                    <span class="stat-title uppercase">Key areas</span>
                    <ul class="mt-3 space-y-2">
                        <li><span class="text-accent mr-3">‚óè</span>Product Engineering</li>
                        <li><span class="text-accent mr-3">‚óè</span>Software Development</li>
                        <li><span class="text-accent mr-3">‚óè</span>Data Analytics</li>
                    </ul>
                </div>
            </div>
        </div>
        <br />
        <div class="timeline-wrapper px-5 md:px-10">
            {experiences.map(({ data: experience }) => (
                <div class="card flex md:flex-row flex-col p-4">
                    <div class="md:w-1/5 w-full p-3 space-y-3">
                        <h3 class="text-xl font-medium">{experience.company}</h3>
                        <span class="text-sm text-gray-600 block mb-2">{experience.sector}</span>
                        <span class="badge badge-sm badge-primary font-semibold uppercase text-white">{experience.period}</span>
                        <p class="flex gap-2 items-center text-lg">
                            <img src={experience.flag_asset} alt={experience.country} />
                            <span>{experience.country}</span>
                        </p>
                    </div>
                    <div class="md:w-4/5 w-full p-3">
                        <h2 class="text-2xl font-medium mb-3">
                            {experience.position} {experience.isOngoing && <span class="badge badge-sm badge-accent uppercase">Ongoing</span>}
                        </h2>
                        <div class="grid md:grid-cols-5 gap-4 md:gap-8 mb-5">
                            <div class="col-span-1 md:col-span-5">
                                <span class="card-info-title">‚úçüèº Key Contribuitions</span>
                                <ul class="mt-6 flex flex-col gap-2">
                                    {experience.contribuitions.map((contribuition) => (
                                        <li class="flex items-center gap-3">
                                            <span class="text-accent">‚óè</span>
                                            <span class="text-neutral-800">{contribuition}</span>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        </div>
                        <br />
                        <BadgeList items={experience.technologies} />
                    </div>
                </div>
            ))}
        </div>
    </Section>
</div>

<style>
    @reference "tailwindcss";
    
    .timeline-wrapper {
        @apply space-y-7 z-1 relative;
    }

    .timeline-wrapper::after {
        @apply border-indigo-500 border-1 border-dashed absolute bottom-0 top-0 left-24 z-0 w-0;
        content: '';
    }
    
    .card {
        @apply rounded-lg border border-indigo-200 text-neutral-900 z-1 bg-white;
        color: var(--color-neutral-dark);
        /* background-color: var(--color-pale-lavender); */
    }

    .card:hover {
        @apply border-indigo-400 shadow-lg shadow-indigo-100;
    }

    .card-info-title {
        @apply text-neutral-400 text-sm uppercase my-3 block;
    }

    .card-content {
        @apply text-neutral-800 text-lg leading-9;
    }
</style>